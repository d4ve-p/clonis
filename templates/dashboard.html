{{define "content"}}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

    <!-- Left Column: Backup Paths -->
    <div class="lg:col-span-2 space-y-8">
        
        <!-- Paths Card -->
        <div class="bg-zinc-900 border border-zinc-800 rounded-lg shadow-sm">
            <div class="p-6 border-b border-zinc-800 flex justify-between items-center">
                <h3 class="font-semibold text-lg text-zinc-100">Backup Manifest</h3>
                <span class="text-xs font-mono bg-zinc-800 text-zinc-400 px-2 py-1 rounded border border-zinc-700">
                    MANIFEST
                </span>
            </div>

            <div class="p-6">
                
                <!-- The Dynamic List Container -->
                {{template "path_list.html" .}}

                <!-- Add Path Form -->
                <div class="border-t border-zinc-800 pt-6 mt-6">
                    <h4 class="text-zinc-400 text-sm font-medium mb-3">Add New Path</h4>
                    
                    <!-- HTMX Form -->
                    <form hx-post="/add-path" 
                          hx-target="#paths-list" 
                          hx-swap="outerHTML"
                          hx-on::after-request="this.reset()"
                          class="space-y-4">
                        
                        <div class="flex gap-2">
                            <input type="text" id="path-input" name="path" placeholder="/hostfs/..." required
                                   class="flex-1 px-3 py-2 bg-zinc-950 border border-zinc-700 rounded text-sm text-zinc-300 font-mono focus:border-indigo-500 outline-none">
                            
                            <input type="hidden" id="type-input" name="type" value="folder">

                            <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded text-sm hover:bg-indigo-500">
                                Add
                            </button>
                        </div>
                    </form>

                    <!-- File Browser Component -->
                    <div class="mt-4 border border-zinc-700 rounded-lg overflow-hidden bg-zinc-950">
                        <div class="p-2 bg-zinc-900 border-b border-zinc-700 flex justify-between items-center">
                            <span class="text-xs font-bold text-zinc-500 uppercase">File Browser</span>
                            <button hx-get="/browse?path=" hx-target="#file-browser" 
                                    class="text-xs text-indigo-400 hover:text-indigo-300">
                                Reset to Root
                            </button>
                        </div>
                        
                        <div id="file-browser" hx-get="/browse?path=" hx-trigger="load">
                            <div class="p-4 text-center text-zinc-600 text-sm animate-pulse">
                                Loading filesystem...
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Logs Card -->
        <div class="bg-zinc-900 border border-zinc-800 rounded-lg shadow-sm">
            <div class="p-6 border-b border-zinc-800">
                <h3 class="font-semibold text-lg text-zinc-100">Activity Log</h3>
                <form action="/backup/run" method="POST">
                    <button hx-post="/backup/run" 
                            hx-swap="none"
                            class="text-xs bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-2 rounded transition font-bold shadow-lg shadow-indigo-500/20 disabled:opacity-50 disabled:cursor-wait flex items-center gap-2"
                            hx-on::after-request="if(event.detail.successful) window.location.reload()">
                        
                        <span>RUN NOW</span>
                        
                        <!-- Loading Spinner -->
                        <svg class="htmx-indicator h-3 w-3 animate-spin text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </button>
                </form>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left">
                    <thead class="bg-zinc-950/50 text-zinc-500 font-medium border-b border-zinc-800">
                        <tr>
                            <th class="px-6 py-3">Status</th>
                            <th class="px-6 py-3">Time</th>
                            <th class="px-6 py-3">Size</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-zinc-800">
                        {{range .Logs}}
                        <tr class="hover:bg-zinc-800/50 transition">
                            <td class="px-6 py-3">
                                <span class="{{if eq .Status "SUCCESS"}}text-emerald-400 bg-emerald-400/10 border-emerald-400/20{{else}}text-rose-400 bg-rose-400/10 border-rose-400/20{{end}} px-2 py-0.5 rounded text-xs border font-medium">
                                    {{.Status}}
                                </span>
                            </td>
                            <td class="px-6 py-3 text-zinc-400">{{.StartedAt.Format "Jan 02 15:04"}}</td>
                            <td class="px-6 py-3 font-mono text-zinc-500">{{.TotalSizeBytes}} B</td>
                        </tr>
                        {{else}}
                        <tr>
                            <td colspan="3" class="px-6 py-8 text-center text-zinc-600 italic">No activity recorded yet.</td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Right Column: Settings -->
    <div class="space-y-6">
        <div class="bg-zinc-900 border border-zinc-800 rounded-lg shadow-sm p-6 sticky top-6">
            <div class="flex items-center gap-2 mb-6 text-indigo-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
                </svg>
                <h3 class="font-semibold text-lg text-zinc-100">Configuration</h3>
            </div>
            
            <div class="space-y-5">
                <div>
                    <label class="block text-xs font-bold text-zinc-500 uppercase mb-2">Cron Schedule</label>
                    <input type="text" value='{{index .Settings "backup_interval"}}' 
                           class="w-full px-3 py-2 bg-zinc-950 border border-zinc-700 rounded text-sm font-mono text-zinc-300 focus:border-indigo-500 focus:outline-none">
                    <p class="text-xs text-zinc-600 mt-1">Format: * * * * *</p>
                </div>

                <div>
                    <label class="block text-xs font-bold text-zinc-500 uppercase mb-2">Retention Count</label>
                    <input type="number" value='{{index .Settings "retention_count"}}' 
                           class="w-full px-3 py-2 bg-zinc-950 border border-zinc-700 rounded text-sm font-mono text-zinc-300 focus:border-indigo-500 focus:outline-none">
                </div>

                <div class="pt-6 border-t border-zinc-800 space-y-3">
                    <button class="w-full py-2 bg-zinc-100 text-zinc-900 font-medium rounded text-sm hover:bg-white transition">
                        Save Changes
                    </button>
                    
                    {{if .DriveLinked}}
                        <div class="w-full py-2 border border-emerald-500/30 text-emerald-400 rounded text-sm bg-emerald-500/10 flex justify-center items-center gap-2 cursor-default">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                            </svg>
                            Drive Connected
                        </div>
                    {{else}}
                        <a href="/drive/connect" class="block w-full text-center py-2 border border-indigo-500/30 text-indigo-400 rounded text-sm hover:bg-indigo-500/10 hover:border-indigo-500/50 transition">
                            Connect Google Drive
                        </a>
                    {{end}}
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript helper to populate the input form -->
    <script>
        function selectPath(path, type) {
            document.getElementById('path-input').value = path;
            document.getElementById('type-input').value = type;
        }
    </script>
</div>
{{end}}